## 你真的理解同步和异步吗？

​     

:fire: ​js中的同步与异步与别的语言(例如java有所不同。java是多线程的语言，有多种方式来实现多线程)。js中的单线程机制意味着，在代码执行的这个车间内，只有一条流水线工作，当然这也就导致了js在执行代码的时候，必须按照一定的顺序来执行。所以在js中同步与异步的区别不在于开辟线程数量的多少，而在于在这条流水线上各个流程之间执行代码的优先级和顺序不同。

:fire:js中的同步和异步，经常让人会感到混乱。例如大家熟知的setTimeout和setInterval函数就是异步函数，因为这二者可以控制js的执行顺序。当然，我们也可以粗略的理解为可以改变程序正常执行顺序的函数的就是异步函数。

```js
console.log(10);
setTimeout(()=>console.log(1),0);
setTimeout(()=>console.log(2),0);
setTimeout(()=>console.log(3),0);
setTimeout(()=>console.log(4),0);
setTimeout(()=>console.log(5),0);
console.log(11);
//10 11 1 2 3 4 5
```

:fire:上述代码执行结果为10,11,1,2,3,4,5，很明显的可以看到程序会将setTimeout的执行放到最后面，事实上，这里面具体的规则涉及到了宏任务与微任务，关于宏任务和微任务不在本文中做详细描述。

:fire:js中有这么一种机制，在js中每一次的执行，都是按照一个时间帧来执行的，每一个时间帧会存在一个任务队列，每一个任务队列执行的时候都会创建一个栈空间，js引擎会把同步任务放入到当前要执行这个时间帧的任务队列中优先执行，而把异步任务放入到下一个新的时间帧中的任务队列中，当一次执行完这个时间帧的任务队列的时候，才会执行到下一个时间帧的任务队列。

:fire:`补充:`js中所有的任务可以分为两种，同步任务和异步任务。

- 同步任务：在主时间帧一次执行完毕的任务叫做同步任务，只有当前一个任务执行完毕，才会执行下一个任务。
- 异步任务：不在主时间帧，而是在其余的时间帧的上的任务

:fire:`执行机制:`

- 所有的同步任务都首先会放到主时间帧上执行，这时候会创建一个单独的执行栈空间。
- 然后异步任务都会放置到不同时间帧下的任务队列中(注意，不是所有的异步任务都会放到同一个任务队列)
- 一旦，执行栈中同步任务全部都执行完毕，引擎就会去读取下一个任务队列中的任务，并且执行。

:fire:`​任务队列的实质:`

以上所讲的任务队列其实是一个事件队列(也可以看作是消息队列)，每完成一项任务，就在任务队列中添加一个事件，表示该异步任务已经进去执行栈了，主线程读取目标任务，就是读取里面有哪些事件，除了用户自身产生的事件时候，还包括一些I/O设备的事件。

只要指定过这些事件的回调函数，这些事件就会进入到任务队列中。当主线成执行异步任务的时候，其实执行对应的回调函数。

