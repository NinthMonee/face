OSI七层协议：(从底层到上层)

1. 物理层
2. 数据链路层
3. 网络层 IP、ARP、ICMP、RIP、OSPF  packet（数据包）
4. 运输层 TCP/UDP   segment（数据段）
5. 会话层：三种通信方式，单工、半双工、全双工  数据包为报文
6. 表示层
7. 应用层：http、ftp、smtp、telnet、dns   数据包为报文

TCP/IP的体系结构：（从上层到底层）

应用层:FTP、SMTP

运输层：TCP/UDP

网际层：IP

网络接口层



五层协议的体系结构：

​	应用层：

​	运输层

​    网络层

​	数据链路层

​	物理层





TCP和UDP

TCP： **面向连接的，可靠的，基于字节流的传输协议**

UDP： **无连接的、不可靠、基于数据报的传输协议**

1、基于连接与无连接；

2、对系统资源的要求（TCP较多，UDP少）；

3、UDP程序结构较简单；

4、流模式与数据报模式 ；

5、TCP保证数据正确性，UDP可能丢包；

6、TCP保证数据顺序，UDP不保证。

TCP三次握手和四次挥手：

​		三次握手：

1、客户端发送SYN报文段请求建立连接，且初始化一个序号seq=x

2、服务器收到连接请求报文段后，如果同意建立连接，则发送一个SYN+ACK报文段，且初始化一个序号seq=y、

3、客户端收到服务器的确认后，还需要向服务器发送一个 ACK 报文段，至此连接已经建立



四次挥手：

1、客户端发送一个标志位FIN为1的报文段

2、服务器收到后回一个ACK，并检查是否还有数据需要传输

3、服务器没有数据需要传输了，则发送给客户端一个FIN+ACK报文段

4、客户端再返回一个ACK,经过2MSL的等待后才关闭连接，而服务器只要收到这个ACK就会马上关闭，如果未收到则会有一个超时重传机制。



为什么不能两次握手建立连接？

3次握手完成两个重要的功能，既要双方做好发送数据的准备工作，也要允许双方就初始序列号进行协商，这个序列号在握手过程中被发送和确认。因为三次握手是建立安全连接的最小连接数。A向B发送连接请求分组，B向A响应确认应答分组，如果只有两次握手，现在就应该已经连接成功了，但是这时候A不一定能收到B的应答，一旦这次应答分组丢失，A就不知道B是否接到了自己的分组，也不知道B是否已经准备好。在这种情况下，A只能认为连接还未建立成功，继续等待。这样就会形成死锁。



`为什么关闭连接的时候需要等待2MSL？`

这是为了保证A发送给B的最后一个ACK报文段能够到达B.

因为这个报文段很可能会丢失，从而导致B在关闭连接之前收不到对已经发送报文的段的确认。B收不到对这个这个FIN+ACK报文段的确认。B就会去超时重传，而A就能在2MSL时间内收到这个重传的报文段，接着A再重传一次。直到A和B都进入Close状态。



`如果已经建立连接，但是客户端出现了故障怎么办？`

Answer：除了等待计时器外，TCP 还设有一个保活计时器（keepalive timer）。设想有这样的情况：客户已主动与服务器建立了 TCP 连接，但后来客户端的主机突然出现故障。显然，服务器之后就不能再收到客户发来的数据。因此就需要措施使服务器不白等。
服务器每收到一次客户的数据，就重置保活计时器，时间的设置一般是两小时。若两小时没有收到客户的数据，服务器就发送一个探测报文段，以后每隔 75 秒发送一次，若一连发送 10 个探测报文段后仍无客户的响应，服务器就认为客户端出现了故障，接着就关闭这个连接。



​	