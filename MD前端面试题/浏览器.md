浏览器有哪些线程？

- GUI渲染线程
    - 负责浏览器界面的渲染，解析HTML、CSS，构建DOM树和RenderObject 树，布局和绘制
    - 当页面需要重绘或者回流的时候，该线程就会被触发
- JS引擎线程
    - JS内核，负责解析和运行JS。js引擎会一直等待任务队列中任务的到来，然后加以处理，一个Tab页中无论什么时候都只有一个JS线程在运行js程序。
    - 同样注意，GUI渲染线程与JS引擎线程是互斥的，所以JS执行的时间过长，这样就会造成页面的的渲染不连贯，导致页面渲染加载阻塞。
- 事件触发线程
    - 归属于浏览器而不是JS引擎，用来控制事件循环。
    - 当JS引擎执行代码块如setTimeout时，就会将对应任务添加到事件线程中。当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的尾部，等待js引擎的处理。
- 定时器触发线程
    - setInterval与setTimeout所在线程
    - 浏览器定时计数器并不是由js引擎计数的，因为js引擎是单线程的，如果处于阻塞线程状态就会影响计时的准确性。因此通过单独线程来计时并触发定时任务。
- 异步http请求线程
    - XMLHttpRequest 在连接后通过浏览器新开一个线程来处理请求。
        检测到状态变更时，如果设置有回调函数，异步线程就产生状态变更事件，将这个回调再放入事件队列中。再由 JavaScript 引擎执行。

浏览器的渲染过程：

浏览器的内核指的是什么？

- 处理 HTML 并构建 DOM 树。
- 处理 CSS 构建 CSSOM 树。
- 将 DOM 与 CSSOM 合并成一个渲染树。
- 根据渲染树来布局，计算每个节点的位置。
- 调用 GPU 绘制，合成图层，显示在屏幕上。

`图层`

一般来说，可以把普通文档流看成是一个图层，特定的属性可以生成一个新的图层，不同的图层渲染互不影响，所以对于某些频繁需要渲染的建议单独生成一个新图层，提高性能，但也不能生成过多的图层，会引起反作用。

通过以下几个常用属性可以生成新图层

- 3D 变换：translate3d、ranslateZ
- will-change
- video、iframe 标签
- 通过动画实现的 opacity 动画转换
- position: fixed

`当一个元素在自己图层内发生变化的时候它的回流和重绘只会在图层内部发生，利用这一特性可以减少了浏览器对于重绘与回流的运算量`

`回流和重绘`

重绘和回流是渲染步骤的一小部分，但是这两个对于性能影响会很大。

- 回流是布局或者几何属性需要改变就称为回流。
- 重绘是当节点需要更改外观而不会影响布局的，比如改变 color 就叫称为重绘

回流必定发生重绘、重绘不一定引发回流。回流的成本比重绘高的多，改变深层次的节点很可能会导致父节点的一系列回流



`浏览器的同源策略`

同源指的是：

- 协议相同
- 域名相同
- 端口相同

`它限制了什么？`

- Cookie localStorage和indexDB无法获取
- DOM无法获得
- AJAX请求不能发送

它的目的就是为了保证用户信息的安全，防止恶意的窃取数据。cookie是用来保存用户登录信息的，如果没有同源策略，cookie就可以共享，那么 是极为不安全的。

`如何跨域，也就是规避同源策略？`

1、JSONP

利用Script标签没有跨域限制的漏洞，通过script标签指向一个需要访问的地址并提供一个回调函数来接收数据，就是给url加上一个callback参数。

缺点：仅限于GET请求

2、CORS

实现CORS通信的关键是后端，只要后端实现的Cors，就实现了跨域，

服务端设置(添加响应头部)`Access-Control-Allow-Origin`就可以开启 CORS。 该属性表示哪些域名可以访问资源，如果设置通配符则表示所有网站都可以访问资源。

3、document.domian

该方式用于二级域名相同的情况下，比如`a.test.com`和`b.test.com`适用于该方式。只需要给页面添加`document.domain = 'test.com'`表示二级域名都相同就可以实现跨域

4、postMessage

这是H5新添加一种发送消息的方式，它通常用户获取嵌入页面中的第三方页面数据，一个页面发送消息，另一个页面判断来源并接受消息

5、配置代理服务器

这种方式依赖于webpack的devSvrver配置项。

`优雅降级和渐进增强`

渐进增强：一开始就针对低版本浏览器进行构建页面，完成基本的功能，然后针对高级浏览器进行效果，交互、追加功能达到更好的体验。

优雅降级：一开始就构建站点的完整功能，然后针对浏览器测试和修复，比如一开始就使用了C3的特性构建了一个应用，然后逐步针对各大浏览器进行了hack使其可以在低版本浏览器上正常浏览。



`存储：cookie  session  token  indexedDB的区别`

| 特性         | cookie                                   | localStorage             | sessionStorage | indexDB                  |
| :----------- | :--------------------------------------- | :----------------------- | :------------- | :----------------------- |
| 数据生命周期 | 一般由服务器生成，可以设置过期时间       | 除非被清理，否则一直存在 | 页面关闭就清理 | 除非被清理，否则一直存在 |
| 数据存储大小 | 4K                                       | 5M                       | 5M             | 无限                     |
| 与服务端通信 | 每次都会携带在 header 中，会影响请求性能 | 不参与                   | 不参与         | 不参与                   |

